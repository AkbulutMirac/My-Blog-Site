<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirac's Blog</title>
    <link rel="icon" type="image/png" href="/static/sitem2.png">
    <meta property="og:image" content="/static/sitem2.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/static/sitem2.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #f5f0e8;
            --text-color: #1a1a1a;
            --text-muted: #666;
            --link-color: #5a4fcf;
            --link-hover: #4338ca;
            --border-color: #e0d8cc;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }

        /* Header */
        header {
            padding: 30px 0;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-color);
            text-decoration: none;
        }

        nav {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        nav a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s;
        }

        nav a:hover {
            color: var(--text-color);
        }

        .nav-icons {
            display: flex;
            gap: 15px;
            margin-left: 15px;
            padding-left: 15px;
            border-left: 1px solid var(--border-color);
        }

        .nav-icons a, .nav-icons button {
            color: var(--text-muted);
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            transition: color 0.2s;
        }

        .nav-icons a:hover, .nav-icons button:hover {
            color: var(--text-color);
        }

        .nav-icons svg {
            width: 18px;
            height: 18px;
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 40px 0;
        }

        .divider {
            height: 1px;
            background: var(--border-color);
            margin-bottom: 50px;
        }

        .welcome h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .welcome p {
            color: var(--text-muted);
            font-size: 1rem;
            margin-bottom: 50px;
        }

        .welcome p strong {
            color: var(--text-color);
        }

        /* Blog Posts */
        .posts-section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 25px;
        }

        .posts-list {
            list-style: disc;
            padding-left: 20px;
        }

        .posts-list li {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            flex-wrap: wrap;
            gap: 10px;
        }

        .posts-list a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.2s;
        }

        .posts-list a:hover {
            color: var(--link-hover);
            text-decoration: underline;
        }

        .post-date {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .no-posts {
            color: var(--text-muted);
            font-style: italic;
        }

        /* New Post Button */
        .new-post-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--link-color);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 0.9rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 30px;
            font-family: inherit;
        }

        .new-post-btn:hover {
            background: var(--link-hover);
        }

        /* Footer */
        footer {
            padding: 40px 0;
            text-align: center;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }

        footer p {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 0;
            width: 100%;
            max-width: 900px;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-color);
            border-radius: 12px 12px 0 0;
        }

        .modal-header h2 {
            font-size: 1.3rem;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-muted);
            line-height: 1;
            padding: 5px 10px;
        }

        .close-btn:hover {
            color: var(--text-color);
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-radius: 0 0 12px 12px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-color);
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input[type="text"]:focus {
            outline: none;
            border-color: var(--link-color);
            box-shadow: 0 0 0 3px rgba(90, 79, 207, 0.1);
        }

        /* Rich Text Editor - Warm Style */
        .editor-container {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
            overflow: hidden;
        }

        .editor-tabs {
            display: flex;
            background: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
        }

        .editor-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 0.9rem;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            position: relative;
        }

        .editor-tab.active {
            color: var(--text-color);
        }

        .editor-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--link-color);
        }

        .editor-toolbar {
            display: flex;
            gap: 2px;
            padding: 10px 12px;
            background: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            align-items: center;
        }

        .toolbar-btn {
            background: none;
            border: none;
            padding: 6px 8px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.15s;
            font-family: inherit;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
            height: 32px;
            vertical-align: middle;
        }

        .toolbar-btn:hover {
            background: var(--border-color);
            color: var(--text-color);
        }

        .toolbar-btn.active {
            background: var(--border-color);
            color: var(--text-color);
        }

        .toolbar-divider {
            width: 1px;
            height: 20px;
            background: var(--border-color);
            margin: 0 8px;
        }

        .toolbar-btn svg {
            width: 18px;
            height: 18px;
            display: block;
        }

        label.toolbar-btn {
            position: relative;
            top: 5px;
        }

        /* Heading button style */
        .toolbar-btn.heading-btn {
            min-width: 44px;
            padding: 6px 10px;
            font-weight: 700;
            border-radius: 6px;
            color: var(--text-muted);
            background: transparent;
            font-family: inherit;
        }

        .toolbar-btn.heading-btn:hover {
            background: var(--border-color);
            color: var(--text-color);
        }

        /* Editor heading styles so headings look like headings while editing */
        .editor-content h1 {
            font-size: 1.6rem;
            margin: 0 0 0.6rem 0;
            font-weight: 700;
        }

        .editor-content h2 {
            font-size: 1.2rem;
            margin: 0 0 0.5rem 0;
            font-weight: 700;
            color: var(--text-color);
        }

        /* The actual editor area */
        .editor-content {
            min-height: 350px;
            max-height: 550px;
            overflow-y: auto;
            padding: 20px;
            color: var(--text-color);
            font-size: 1rem;
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.7;
            outline: none;
            background: white;
        }

        .editor-content:empty::before {
            content: attr(data-placeholder);
            color: var(--text-muted);
            pointer-events: none;
        }

        .editor-content a {
            color: var(--link-color);
            text-decoration: none;
        }

        .editor-content a:hover {
            text-decoration: underline;
        }

        .editor-content img {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            display: block;
        }

        .editor-content blockquote {
            border-left: 3px solid var(--border-color);
            padding-left: 15px;
            margin: 10px 0;
            color: var(--text-muted);
        }

        .editor-content pre {
            background: var(--bg-color);
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
        }

        .editor-content code {
            background: var(--bg-color);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
        }

        /* Drop overlay */
        .editor-drop-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(90, 79, 207, 0.1);
            border: 2px dashed var(--link-color);
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 6px;
        }

        .editor-drop-overlay.active {
            display: flex;
        }

        .editor-drop-overlay span {
            background: var(--link-color);
            color: white;
            padding: 12px 24px;
            border-radius: 20px;
            font-weight: 500;
        }

        /* Character count */
        .editor-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .submit-btn, .modal-footer .cancel-btn {
            padding: 10px 24px;
            font-size: 0.95rem;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.15s;
            border: none;
        }

        .submit-btn {
            background: var(--link-color);
            color: white;
        }

        .submit-btn:hover {
            background: var(--link-hover);
        }

        .modal-footer .cancel-btn {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border-color);
        }

        .modal-footer .cancel-btn:hover {
            background: var(--bg-color);
            color: var(--text-color);
        }

        /* File input hidden */
        input[type="file"] {
            display: none;
        }

        /* Modal adjustments for warm theme */
        .modal {
            background: white;
            border-radius: 12px;
            padding: 0;
            width: 100%;
            max-width: 850px;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-color);
            border-radius: 12px 12px 0 0;
        }

        .modal-header h2 {
            font-size: 1.2rem;
            margin: 0;
            color: var(--text-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            line-height: 1;
            padding: 5px;
        }

        .close-btn:hover {
            color: var(--text-color);
        }

        .modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
            background: white;
        }

        .modal-footer {
            padding: 18px 25px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            border-radius: 0 0 12px 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-color);
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group input[type="text"]:focus {
            outline: none;
            border-color: var(--link-color);
            box-shadow: 0 0 0 3px rgba(90, 79, 207, 0.1);
        }

        .form-group input[type="text"]::placeholder {
            color: var(--text-muted);
        }

        /* Password Modal */
        .password-modal {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 380px;
            text-align: center;
        }

        .password-modal h3 {
            margin-bottom: 10px;
        }

        .password-modal p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .password-modal input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .password-modal input:focus {
            outline: none;
            border-color: var(--link-color);
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-group button {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            font-size: 0.95rem;
            cursor: pointer;
            font-family: inherit;
        }

        .confirm-btn {
            background: var(--link-color);
            color: white;
        }

        .confirm-btn:hover {
            background: var(--link-hover);
        }

        .cancel-btn {
            background: var(--border-color);
            color: var(--text-color);
        }

        .cancel-btn:hover {
            background: #d4ccc0;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 2000;
        }

        .toast.active {
            transform: translateX(0);
        }

        .toast.success {
            background: #22c55e;
        }

        .toast.error {
            background: #ef4444;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .welcome h1 {
                font-size: 1.5rem;
            }
            
            header .container {
                flex-direction: column;
                gap: 15px;
            }

            .nav-icons {
                border-left: none;
                margin-left: 0;
                padding-left: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="/" class="logo">Mira√ß</a>
            <nav>
                <a href="/">Blog</a>
                <div class="nav-icons">
                    <a href="https://github.com/AkbulutMirac" target="_blank" title="GitHub">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </a>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="divider"></div>
            
            <section class="welcome">
                <h1>Welcome to My Blog</h1>
                <p>Hi! I'm <strong>Mira√ß</strong>, here is my personal space to share thoughts and experiences.</p>
            </section>

            <section class="posts-section">
                <h2>Blog Posts</h2>
                <ul class="posts-list" id="postsList">
                    <!-- Posts will be loaded here -->
                </ul>
                
                <button class="new-post-btn" onclick="openNewPostModal()">
                    + New Post
                </button>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>¬© 2026 Mirac. All rights reserved.</p>
        </div>
    </footer>

    <!-- New Post Modal -->
    <div class="modal-overlay" id="newPostModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Create a post</h2>
                <button class="close-btn" onclick="closeNewPostModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="postSlug">Title</label>
                    <input type="text" id="postSlug" placeholder="Enter post title" required>
                    <div style="margin-top:8px;color:var(--text-muted);font-size:0.9rem">Title preview: <span id="slugPreview" style="font-family:monospace"></span></div>
                </div>
                
                <div class="form-group" style="position: relative;">
                    <div class="editor-container" id="editorContainer">
                        <!-- Tabs -->
                        <div class="editor-tabs">
                            <button type="button" class="editor-tab active">Text</button>
                        </div>
                        
                        <!-- Toolbar -->
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn heading-btn" onclick="insertHeading(1)" title="Ba≈ülƒ±k (H1)">H1</button>
                            <button type="button" class="toolbar-btn heading-btn" onclick="insertHeading(2)" title="Ara Ba≈ülƒ±k (H2)">H2</button>
                            <button type="button" class="toolbar-btn" onclick="formatText('bold')" title="Bold">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/></svg>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('italic')" title="Italic">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/></svg>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('strikethrough')" title="Strikethrough">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 19h4v-3h-4v3zM5 4v3h5v3h4V7h5V4H5zM3 14h18v-2H3v2z"/></svg>
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button type="button" class="toolbar-btn" onclick="insertLink()" title="Link">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button type="button" class="toolbar-btn" onclick="formatText('insertUnorderedList')" title="Bullet List">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/></svg>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="formatText('insertOrderedList')" title="Numbered List">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/></svg>
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <button type="button" class="toolbar-btn" onclick="formatText('formatBlock', 'blockquote')" title="Quote">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/></svg>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertCodeBlock()" title="Code Block">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
                            </button>
                            
                            <div class="toolbar-divider"></div>
                            
                            <label class="toolbar-btn" title="Add Image">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                                <input type="file" id="imageUpload" accept="image/*" multiple onchange="handleImageUpload(event)">
                            </label>
                        </div>
                        
                        <!-- Drop overlay -->
                        <div class="editor-drop-overlay" id="dropOverlay">
                            <span>Drop to upload</span>
                        </div>
                        
                        <!-- Editable content area -->
                        <div 
                            id="postContent" 
                            class="editor-content"
                            contenteditable="true"
                            data-placeholder="Text (optional)"
                        ></div>
                        
                        <!-- Footer -->
                        <div class="editor-footer">
                            <span id="charCount">0 characters</span>
                            <span>Drag & drop images or paste from clipboard</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="cancel-btn" onclick="closeNewPostModal()">Cancel</button>
                <button type="button" class="submit-btn" onclick="submitPost()">Post</button>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="modal-overlay" id="passwordModal">
        <div class="password-modal">
            <h3>üîê Password Required</h3>
            <p>Enter your password to publish</p>
            <input type="password" id="passwordInput" placeholder="Password">
            <div class="btn-group">
                <button class="cancel-btn" onclick="closePasswordModal()">Cancel</button>
                <button class="confirm-btn" onclick="submitWithPassword()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        let pendingSlug = '';
        let pendingContent = '';

        document.addEventListener('DOMContentLoaded', () => {
            loadBlogPosts();
        });

        async function loadBlogPosts() {
            const postsList = document.getElementById('postsList');
            
            try {
                const response = await fetch('/list_blog_posts');
                const text = await response.text();
                
                if (text.trim() === '') {
                    postsList.innerHTML = '<li class="no-posts">No posts yet.</li>';
                    return;
                }
 
                const lines = text.split('\n').filter(p => p.trim() !== '');
                postsList.innerHTML = lines.map(line => {
                    const parts = line.split('|');
                    const slug = parts[0];
                    const date = parts[1] || '';
                    const title = parts.slice(2).join('|') || '';
                    const displayTitle = title && title.trim() !== '' ? title : formatTitle(slug);
                    return `
                    <li>
                        <a href="/blog/${slug}">${displayTitle}</a>
                        <span class="post-date">(${date})</span>
                    </li>
                `;
                }).join('');
            } catch (error) {
                postsList.innerHTML = '<li class="no-posts">Error loading posts.</li>';
            }
        }

        function formatTitle(slug) {
            return slug.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        }

        function getDate() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function openNewPostModal() {
            document.getElementById('newPostModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            setupEditor();
            // initialize slug preview
            const titleInput = document.getElementById('postSlug');
            const preview = document.getElementById('slugPreview');
            if (titleInput && preview) {
                preview.textContent = slugify(titleInput.value || '');
                titleInput.addEventListener('input', () => preview.textContent = slugify(titleInput.value || ''));
            }
        }

        function closeNewPostModal() {
            document.getElementById('newPostModal').classList.remove('active');
            document.getElementById('postSlug').value = '';
            document.getElementById('postContent').innerHTML = '';
            document.body.style.overflow = '';
        }

        function openPasswordModal() {
            document.getElementById('passwordModal').classList.add('active');
            document.getElementById('passwordInput').focus();
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
            document.getElementById('passwordInput').value = '';
        }

        // Editor Setup
        function setupEditor() {
            const container = document.getElementById('editorContainer');
            const editor = document.getElementById('postContent');
            const dropOverlay = document.getElementById('dropOverlay');

            // Drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                container.addEventListener(eventName, (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                }, false);
            });

            container.addEventListener('dragenter', () => dropOverlay.classList.add('active'));
            container.addEventListener('dragover', () => dropOverlay.classList.add('active'));
            container.addEventListener('dragleave', (e) => {
                if (!container.contains(e.relatedTarget)) {
                    dropOverlay.classList.remove('active');
                }
            });
            container.addEventListener('drop', (e) => {
                dropOverlay.classList.remove('active');
                handleFiles(e.dataTransfer.files);
            });

            // Paste handling
            editor.addEventListener('paste', (e) => {
                const items = e.clipboardData.items;
                for (let item of items) {
                    if (item.type.indexOf('image') !== -1) {
                        e.preventDefault();
                        const file = item.getAsFile();
                        handleFiles([file]);
                        return;
                    }
                }
                // Let text paste normally, then clean and render inline markdown
                setTimeout(() => { autoLinkify(); inlineMarkdownify(); }, 100);
            });

            // Auto linkify and inline markdown rendering on input
            editor.addEventListener('input', () => {
                updateCharCount();
                inlineMarkdownify();
            });

            // Auto linkify on blur
            editor.addEventListener('blur', autoLinkify);
        }

        function handleImageUpload(e) {
            handleFiles(e.target.files);
            e.target.value = '';
        }

        function handleFiles(files) {
            [...files].forEach(file => {
                if (!file.type.startsWith('image/')) {
                    showToast('Only image files are allowed!', 'error');
                    return;
                }
                if (file.size > 10 * 1024 * 1024) {
                    showToast('Image too large! Max 10MB', 'error');
                    return;
                }
                insertImage(file);
            });
        }

        function insertImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const editor = document.getElementById('postContent');
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = file.name;
                
                // Insert at cursor or at end
                const selection = window.getSelection();
                if (selection.rangeCount > 0 && editor.contains(selection.anchorNode)) {
                    const range = selection.getRangeAt(0);
                    range.insertNode(document.createElement('br'));
                    range.insertNode(img);
                    range.insertNode(document.createElement('br'));
                } else {
                    editor.appendChild(document.createElement('br'));
                    editor.appendChild(img);
                    editor.appendChild(document.createElement('br'));
                }
                
                showToast('Image added!', 'success');
                updateCharCount();
            };
            reader.readAsDataURL(file);
        }

        // Formatting functions
        function formatText(command, value = null) {
            document.getElementById('postContent').focus();
            document.execCommand(command, false, value);
        }

        function insertLink() {
            const url = prompt('Enter URL:');
            if (url) {
                document.getElementById('postContent').focus();
                document.execCommand('createLink', false, url);
            }
        }

        function insertCodeBlock() {
            const editor = document.getElementById('postContent');
            const pre = document.createElement('pre');
            pre.innerHTML = '<code>// code here</code>';
            
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.insertNode(pre);
            } else {
                editor.appendChild(pre);
            }
        }

        // Auto-linkify URLs
        function autoLinkify() {
            const editor = document.getElementById('postContent');
            const walker = document.createTreeWalker(editor, NodeFilter.SHOW_TEXT, null, false);
            const urlRegex = /(https?:\/\/[^\s<]+)/g;
            const nodesToProcess = [];
            
            while (walker.nextNode()) {
                const node = walker.currentNode;
                if (node.parentElement.tagName !== 'A' && urlRegex.test(node.textContent)) {
                    nodesToProcess.push(node);
                }
            }
            
            nodesToProcess.forEach(node => {
                const text = node.textContent;
                const fragment = document.createDocumentFragment();
                let lastIndex = 0;
                let match;
                
                urlRegex.lastIndex = 0;
                while ((match = urlRegex.exec(text)) !== null) {
                    // Add text before the URL
                    if (match.index > lastIndex) {
                        fragment.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));
                    }
                    // Create link
                    const link = document.createElement('a');
                    link.href = match[0];
                    link.textContent = match[0];
                    link.target = '_blank';
                    fragment.appendChild(link);
                    lastIndex = urlRegex.lastIndex;
                }
                // Add remaining text
                if (lastIndex < text.length) {
                    fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
                }
                
                node.parentNode.replaceChild(fragment, node);
            });
        }

        function updateCharCount() {
            const editor = document.getElementById('postContent');
            const text = editor.innerText || '';
            document.getElementById('charCount').textContent = `${text.length} characters`;
        }

        // Convert editor content to markdown
        function htmlToMarkdown(html) {
            let md = html;
            
            // Convert images
            md = md.replace(/<img[^>]+src="([^"]+)"[^>]*alt="([^"]*)"[^>]*>/gi, '![$2]($1)');
            md = md.replace(/<img[^>]+src="([^"]+)"[^>]*>/gi, '![]($1)');

                // Convert headings
                md = md.replace(/<h1[^>]*>([\s\S]*?)<\/h1>/gi, function(m, p1){ return '# ' + p1.replace(/<[^>]+>/g,'').trim() + '\n\n'; });
                md = md.replace(/<h2[^>]*>([\s\S]*?)<\/h2>/gi, function(m, p1){ return '## ' + p1.replace(/<[^>]+>/g,'').trim() + '\n\n'; });
            
            // Convert links
            md = md.replace(/<a[^>]+href="([^"]+)"[^>]*>([^<]+)<\/a>/gi, '[$2]($1)');
            
            // Convert formatting
            md = md.replace(/<strong>([^<]+)<\/strong>/gi, '**$1**');
            md = md.replace(/<b>([^<]+)<\/b>/gi, '**$1**');
            md = md.replace(/<em>([^<]+)<\/em>/gi, '*$1*');
            md = md.replace(/<i>([^<]+)<\/i>/gi, '*$1*');
            md = md.replace(/<s>([^<]+)<\/s>/gi, '~~$1~~');
            md = md.replace(/<strike>([^<]+)<\/strike>/gi, '~~$1~~');
            
            // Convert lists
            md = md.replace(/<li>([^<]+)<\/li>/gi, '- $1\n');
            md = md.replace(/<\/?[uo]l>/gi, '\n');
            
            // Convert blockquotes
            md = md.replace(/<blockquote>([^<]+)<\/blockquote>/gi, '> $1\n');
            
            // Convert code
            md = md.replace(/<pre><code>([^<]+)<\/code><\/pre>/gi, '```\n$1\n```');
            md = md.replace(/<code>([^<]+)<\/code>/gi, '`$1`');
            
            // Convert line breaks and divs
            md = md.replace(/<br\s*\/?>/gi, '\n');
            md = md.replace(/<\/div>/gi, '\n');
            md = md.replace(/<div>/gi, '');
            md = md.replace(/<\/p>/gi, '\n\n');
            md = md.replace(/<p>/gi, '');
            
            // Clean up remaining tags
            md = md.replace(/<[^>]+>/g, '');
            
            // Decode HTML entities
            const textarea = document.createElement('textarea');
            textarea.innerHTML = md;
            md = textarea.value;
            
            // Clean up extra newlines
            md = md.replace(/\n{3,}/g, '\n\n').trim();
            
            return md;
        }

        function submitPost() {
            const title = document.getElementById('postSlug').value.trim();
            const editor = document.getElementById('postContent');
            const contentMd = htmlToMarkdown(editor.innerHTML);

            if (!title) {
                showToast('Please enter a title!', 'error');
                return;
            }

            if (!contentMd.trim()) {
                showToast('Please write some content!', 'error');
                return;
            }

            // create a safe slug from title
            pendingSlug = slugify(title);
            pendingContent = contentMd;
            // store title so backend can use it
            pendingTitle = title;

            openPasswordModal();
        }

        async function submitWithPassword() {
            const password = document.getElementById('passwordInput').value;
            
            if (!password) {
                showToast('Please enter password!', 'error');
                return;
            }

            try {

                const url = `/post_blog_post_markdown/${pendingSlug}/${encodeURIComponent(password)}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ markdown_content: pendingContent, title: pendingTitle })
                });

                if (response.ok) {
                    showToast('Post published! üéâ', 'success');
                    closePasswordModal();
                    closeNewPostModal();
                    loadBlogPosts();
                } else {
                    const errorText = await response.text();
                    showToast(errorText || 'Error occurred!', 'error');
                }
            } catch (error) {
                showToast('Connection error!', 'error');
            }
        }

        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') submitWithPassword();
        });

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} active`;
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            const editor = document.getElementById('postContent');
            if (document.activeElement !== editor) return;
            
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'b': e.preventDefault(); formatText('bold'); break;
                    case 'i': e.preventDefault(); formatText('italic'); break;
                    case 'k': e.preventDefault(); insertLink(); break;
                    case '1': e.preventDefault(); insertHeading(1); break;
                    case '2': e.preventDefault(); insertHeading(2); break;
                }
            }
        });

        // Slugify function for creating safe filenames from titles
        function slugify(text) {
            return text.toString().toLowerCase()
                .normalize('NFKD') // separate accents
                .replace(/\p{Diacritic}/gu, '')
                .replace(/[^a-z0-9\s-]/g, '')
                .trim()
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-');
        }

        // Heading insert function: create actual heading elements so they look like headings in the editor
        function insertHeading(level) {
            const editor = document.getElementById('postContent');
            editor.focus();
            const sel = window.getSelection();
            if (!sel.rangeCount) return;

            let node = sel.anchorNode;
            if (!node) return;

            // helper: strip leading markdown heading markers from a string
            function stripLeadingHashes(s) {
                return s.replace(/^\s{0,3}#{1,6}\s+/, '');
            }

            // Prefer the parent element for block lookup
            let candidate = node.nodeType === 3 ? node.parentNode : node;
            while (candidate && candidate !== editor && !/^(DIV|P|H1|H2|H3|PRE|BLOCKQUOTE|LI)$/i.test(candidate.nodeName)) {
                candidate = candidate.parentNode;
            }

            const tag = 'h' + Math.min(Math.max(level, 1), 6);

            // If no suitable block found or candidate is editor, insert a new heading at caret.
            // If caret is inside a text node, split it so text before caret remains, and text after caret
            // becomes the content of the heading (with leading hashes removed).
            if (!candidate || candidate === editor) {
                const range = sel.getRangeAt(0);
                const startNode = sel.anchorNode;
                const startOffset = sel.anchorOffset;

                // If inside a text node, split it
                if (startNode && startNode.nodeType === 3) {
                    const text = startNode.textContent || '';
                    const beforeText = text.slice(0, startOffset);
                    const afterText = text.slice(startOffset);

                    const beforeNode = document.createTextNode(beforeText);
                    const afterNode = document.createTextNode(afterText);

                    const parent = startNode.parentNode;
                    parent.insertBefore(beforeNode, startNode);
                    parent.insertBefore(afterNode, startNode);
                    parent.removeChild(startNode);

                    // create heading and move 'afterNode' content into it (stripping leading hashes)
                    const h = document.createElement(tag);
                    const cleaned = stripLeadingHashes(afterNode.textContent || '');
                    h.textContent = cleaned;
                    parent.insertBefore(h, afterNode);
                    parent.removeChild(afterNode);

                    // place caret at end of heading
                    const newRange = document.createRange();
                    newRange.selectNodeContents(h);
                    newRange.collapse(false);
                    sel.removeAllRanges();
                    sel.addRange(newRange);
                    return;
                } else {
                    // Not in a text node: just insert a new empty heading block
                    const h = document.createElement(tag);
                    h.innerHTML = '<br>';
                    range.deleteContents();
                    range.insertNode(h);
                    const newRange = document.createRange();
                    newRange.selectNodeContents(h);
                    newRange.collapse(true);
                    sel.removeAllRanges();
                    sel.addRange(newRange);
                    return;
                }
            }

            // Replace candidate block with heading and preserve inline children
            const h = document.createElement(tag);
            // move children but strip leading markdown hashes from the first text child
            while (candidate.firstChild) {
                const child = candidate.firstChild;
                if (child.nodeType === 3) {
                    // text node: strip leading hashes then append
                    const cleaned = stripLeadingHashes(child.textContent || '');
                    if (cleaned !== '') {
                        h.appendChild(document.createTextNode(cleaned));
                    }
                    // remove the text child
                    candidate.removeChild(child);
                } else {
                    h.appendChild(child);
                }
            }
            candidate.parentNode.replaceChild(h, candidate);

            // Move caret to end of heading
            const newRange = document.createRange();
            newRange.selectNodeContents(h);
            newRange.collapse(false);
            sel.removeAllRanges();
            sel.addRange(newRange);
        }
    </script>
</body>
</html>